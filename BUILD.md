# Сборка и развертывание Match-3 Engine

## Требования

- Node.js >= 16.0.0
- npm >= 8.0.0

## Установка зависимостей

```bash
npm install
```

## Команды разработки

### Запуск в режиме разработки
```bash
npm run dev
# или
npm start
```

Запускает dev-сервер на http://localhost:8080 с hot reload.

### Сборка для разработки
```bash
npm run build:dev
```

Создает неоптимизированную сборку в папке `dist/`.

## Продакшн сборка

### Полная продакшн сборка
```bash
npm run build
```

Эта команда:
- Очищает папку `dist/`
- Минифицирует JavaScript код
- Оптимизирует изображения и аудио файлы
- Создает gzip сжатые версии файлов
- Генерирует source maps
- Разделяет vendor и application код
- Сохраняет все игровые ресурсы (включая аудио)

### Анализ размера бандла
```bash
npm run build:analyze
```

Показывает детальную информацию о размере бандла.

## Структура продакшн сборки

После выполнения `npm run build` в папке `dist/` будет создана следующая структура:

```
dist/
├── index.html                    # Оптимизированный HTML
├── main.[hash].js               # Основной JavaScript бандл
├── vendors.[hash].js            # Vendor зависимости
├── assets/
│   ├── images/                  # Оптимизированные изображения
│   └── audio/                   # Аудио файлы (сжатые)
└── *.js.gz                      # Gzip сжатые версии
```

## Оптимизации продакшн сборки

### JavaScript
- Минификация с помощью Terser
- Удаление console.log и debugger
- Tree shaking неиспользуемого кода
- Разделение vendor и application кода

### HTML
- Минификация HTML
- Удаление комментариев и лишних пробелов
- Автоматическое добавление хешей к файлам

### Ресурсы
- Оптимизация изображений
- Сохранение аудио файлов для полного игрового опыта
- Хеширование имен файлов для кэширования
- Gzip сжатие статических файлов (включая аудио)

### Производительность
- Source maps для отладки
- Предупреждения о размере бандла
- Оптимизация загрузки
- Кэширование аудио файлов

## Развертывание

### Статический хостинг

Скопируйте содержимое папки `dist/` на ваш веб-сервер.

### Netlify

1. Подключите репозиторий к Netlify
2. Установите build command: `npm run build`
3. Установите publish directory: `dist`

### Vercel

1. Подключите репозиторий к Vercel
2. Vercel автоматически определит настройки сборки

### GitHub Pages

1. Добавьте в `package.json`:
```json
{
  "homepage": "https://username.github.io/repository-name",
  "scripts": {
    "deploy": "gh-pages -d dist"
  }
}
```

2. Установите gh-pages: `npm install --save-dev gh-pages`
3. Выполните: `npm run build && npm run deploy`

## Мониторинг производительности

### Размер бандла
- Основной бандл: < 500KB
- Vendor бандл: < 1MB
- Аудио файлы: < 25MB (включая сжатие)
- Общий размер: < 30MB

### Время загрузки
- Первая загрузка: < 5 секунд (с аудио)
- Последующие загрузки: < 2 секунды (благодаря кэшированию)

## Отладка продакшн сборки

### Source Maps
Source maps включены в продакшн сборку для отладки.

### Логирование
В продакшн сборке отключены console.log для производительности.

### Анализ бандла
Используйте `npm run build:analyze` для анализа размера бандла.

## Проблемы и решения

### Большой размер бандла
1. Проверьте размер аудио файлов (оптимизируйте качество)
2. Используйте динамические импорты
3. Оптимизируйте изображения
4. Рассмотрите возможность ленивой загрузки аудио

### Медленная загрузка
1. Включите gzip сжатие на сервере
2. Используйте CDN для статических файлов
3. Настройте кэширование
4. Рассмотрите предзагрузку критических аудио файлов

### Ошибки в продакшн
1. Проверьте source maps
2. Включите логирование для отладки
3. Проверьте совместимость браузеров
4. Убедитесь, что аудио файлы корректно загружаются 